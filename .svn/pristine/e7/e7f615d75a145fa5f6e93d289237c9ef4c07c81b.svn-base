<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, minimum-scale=1.0, user-scalable=yes,target-densitydpi=medium-dpi">

<script type="text/javascript">
	 $(document).ready(function() {
		var active = '<%=active%>'; // 게시판 카테고리 선택
		$('#'+active).addClass('active'); // 선택된 카테고리에 'active'클래스 추가
		$('#category').val('<%=active%>'); // 선택된 카테고리에 'active'클래스 추가
		$('.board_item').click(function(){
			var cat = this.dataset.cat;
			console.log(cat);
			switch(cat){
				case "base":
				break;

				case "top":
				break;

			}
			window.location.href="hongbo_board_list?category="+cat;

		});
		 comment_ajax();
		 
		$("#go_list").click(function() {
			$("#boardForm").submit();
		});
		
		$(".board_tab").click(function(e){
			e.preventDefault();
			
			var comment_type = $(this).attr("comment_type");
			
			$(".board_tab").removeClass("on");
			$(this).addClass("on");
			
			if(comment_type == "view"){
				$(".comment_write").hide();
				$(".comment_view").show();
			}else if(comment_type == "write"){
				$(".comment_view").hide();
				$(".comment_write").show();
			}
		});
		
		$("#comment_save").click(function(){
			var comment_content = $.trim($("#comment_content").val());
			var board_no = $("#board_no").val();
			
			if(comment_content == ""){
				alert("댓글을 입력해주세요.");
				$("#comment_content").focus();
				return false;
			}else if(confirm("댓글을 등록하시겠습니까?")){
				
				$.ajax({
					type : "post",  
				    url : "/hongbo_comment_save",    
				    dataType : "text",
				    data : {"board_no" : board_no, "comment_content" : comment_content, "mode" : "write"},      
				    success : function(data){
				    	if(data == "success"){
				    		alert("댓글이 등록되었습니다.");
				    		comment_ajax(board_no);
				    	}else{
				    		alert("댓글등록에 실패하였습니다.");
				    		return false;
				    	} 
				    }
				});			
			}
		});
		
		$(".comment_del").live('click', function(){
			var comment_no = $(this).attr("comment_no");
			
			if(confirm("삭제하시겠습니까?")){
				$.ajax({
					type : "post",  
				    url : "/hongbo_comment_save",    
				    dataType : "text",
				    data : {"comment_no" : comment_no, "mode" : "delete"},      
				    success : function(data){
				    	if(data == "success"){
				    		alert("댓글이 삭제되었습니다.");
				    		comment_ajax(board_no);
				    	}else{
				    		alert("댓글삭제에 실패하였습니다.");
				    		return false;
				    	} 
				    }
				});	
			}
		});		
		
		$(".comment_modify").live('click', function(){
			var thisDl = $(this).parents("dl:first");
			thisDl.find(".ori_data").hide();
			thisDl.find(".modify_data").show();
		});
		
		$(".comment_modify_cancel").live('click', function(){
			var thisDl = $(this).parents("dl:first");
			thisDl.find(".modify_data").hide();
			thisDl.find(".ori_data").show();
		});
		
		$(".comment_modify_bt").live('click', function(){
			var thisDl = $(this).parents("dl:first");
			
			var comment_no = $(this).attr("comment_no");
			var comment_content = $.trim(thisDl.find(".comment_modify_content").val());
			var board_no = $("#board_no").val();			
			
			if(comment_content == ""){
				alert("댓글을 입력해주세요.");
				$("#comment_content").focus();
				return false;
			}else if(confirm("댓글을 수정하시겠습니까?")){
				
				$.ajax({
					type : "post",  
				    url : "/hongbo_comment_save",    
				    dataType : "text",
				    data : {"board_no" : board_no, "comment_content" : comment_content, "mode" : "modify", "comment_no" : comment_no},      
				    success : function(data){
				    	if(data == "success"){
				    		alert("댓글이 수정되었습니다.");
				    		comment_ajax(board_no);
				    	}else{
				    		alert("댓글수정에 실패하였습니다.");
				    		return false;
				    	} 
				    }
				});			
			}			
		});
		
		$(".contImg").click(function() {
			if( $(this).get(0).tagName=="IMG" ) {
				var url = "/views/user/hongbo_board/img_view.html?imgSRC="+$(this).attr("src");
				
				var standalone = window.navigator.standalone,
			    userAgent = window.navigator.userAgent.toLowerCase(),
			    safari = /safari/.test( userAgent ),
			    ios = /iphone|ipod|ipad/.test( userAgent );
				
				if( ios ) {
				    if ( !standalone && safari ) {
				        //browser
				    } else if ( standalone && !safari ) {
				        //standalone
				    } else if ( !standalone && !safari ) {
				        //uiwebview
				        window.location="jscall://"+url;
				    };
				} else {
					// not ios
					window.location.href = url;
				};
				//window.location.href = url;
				//window.open('/views/user/hongbo_board/img_view.html?imgSRC='+$(this).attr("src")+'', 'hongboView_Pop', 'width=500, height=500');
			}
		});
	});
	
	function comment_ajax(){
		 
		var board_no = $("#board_no").val();
		var comment_html = "";
		 
		$.ajax({
			type : "post",  
		    url : "/hongbo_comment_list",    
		    dataType : "json",
		    data : {"board_no" : board_no},      
		    success : function(data){
		    	var connectorNo = data.connectorNo;
					    	
		    	if($(data.result).length > 0){
		    		$(data.result).each(function(key, data){
		    			comment_html += "<dl>";
		    			comment_html += "	<dt><p>"+data.orgmem_name+" <span>"+data.c_date+"</span></p> ";
		    			if(connectorNo == data.orgmem_no){ //자신이 쓴 댓글만 삭제가능
		    			 	comment_html += "		<button class='comment_del ori_data' comment_no="+data.comment_no+"><i class='fa fa-trash'></i></button>";
		    			 	comment_html += "		<button class='comment_modify ori_data' comment_no="+data.comment_no+"><i class='fa fa-pen'></i></button>";
		    			}
		    			comment_html += "	</dt>";
		    			comment_html += "	<dd class='ori_data'>"+data.comment_content+"</dd>";
		    			comment_html += "	<dd class='modify_data noline nopadding nomargin' style='display:none;'>";
	    			 	comment_html += "		<textarea class='comment_modify_content' style='width: 100%; height:50px;'>"+data.comment_content+"</textarea>";
	    			 	comment_html += "	</dd>";
	    			 	comment_html += "	<dd class='modify_data align_c' style='display:none;'>";
	    			 	comment_html += "		<button class='comment_modify_bt btn_blue btn_round' comment_no="+data.comment_no+">저장</button>";		    			
	    			 	comment_html += "		<button class='comment_modify_cancel btn_gray btn_round'>취소</button>";
		    			comment_html += "	</dd>";
		    			comment_html += "</dl>";
		    		});	 
		    	}else{
		    		comment_html = "<p class='mt_50 align_c'>등록된 댓글이 없습니다.</p>";
		    	}
		    	 
		    	$(".comment_view").html(comment_html);
		    	 
				$(".board_tab:first").click();
				 
				$("#comment_content").val("");
		    }
		});		 
	 } 
</script>

<div id="board_cat">
	<div class="board_item" data-cat="base" id="base">동문홍보</div>
	<div class="board_item" data-cat="top"  id="top">대구공고 100대 기업</div>
</div>
<div id="container">
	<form name="boardForm" id="boardForm" method="post" action="hongbo_board_list" autocomplete="off">
		<input type="hidden" name="nowPage" value="<%=nowPage%>"/>
		<input type="hidden" name="board_no" id="board_no" value="<%=db_data[0].board_no %>"/>
		<input type="hidden" name="category" id="category" value=""/>
	</form>
	<div class="board_view">
		<h3>
			<strong><%=db_data[0].board_title %></strong>
			<!-- <span class="float_r sms_btn">
				<a href="#"><img src="../../../../images/icon_call.png" alt="전화걸기" class="icon_call" /></a>
				<a href="#"><img src="../../../../images/icon_message.png" alt="문자메세지" class="icon_message" /></a>	
			</span> -->
		</h3>
		<p>조회수 : <%=db_data[0].board_cnt %> / 작성일 : <%=db_data[0].c_date %></p>
		<p>홈페이지 : <a href="http://<%=db_data[0].homepage %>" target="_blank"><%=db_data[0].homepage %></a></p>
		<p class="black">동문(기수) :
			<%=db_data[0].orgmem_name==null ? '' : db_data[0].orgmem_name %>(<%=db_data[0].orgmem_seqNm==null ? '' : db_data[0].orgmem_seqNm %>)
		</p>

		<div class="view_content">
			<p><%=db_data[0].board_content %></p><br/>
			
		<%
		if(db_data_file.length){
			for(var i = 0; i < db_data_file.length; i++){
		%>
			<img src="/file/hongbo_board/<%=db_data_file[i].file_dtname%>" alt="" class="contImg hand"/>
		<%
			}
		}
		%>			
		</div>
	</div>
	<p class="align_r">
		<button class="btn_gray btn_round" id="go_list">목록으로</button>
	</p>
	
	<div class="comment_tab">
		<ul>
			<li style="width:50%;" class="on board_tab" comment_type="view"><a href="#">댓글</a></li>
			<li class="board_tab" comment_type="write"><a href="#">댓글쓰기</a></li>
		</ul>
	</div>
	<div class="comment_write" style="display:none;">
		<textarea rows="4" cols="79" style="width:100%; height:50px; ime-mode:active;" id="comment_content" style="ime-mode:active;"></textarea>
		<p class="align_r">
			<button class="btn_blue btn_round" id="comment_save" style="width: 100%; margin-top: 10px;">댓글등록</button>
		</p>
	</div>
	<div class="comment_view">
	</div>	
</div>
<!-- //컨텐츠 -->
