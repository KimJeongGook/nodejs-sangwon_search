<style>
.overflow {
      height: 400px;
    }
</style>


<script type="text/javascript">
	$(document).ready(function() {
		var adnm = "<%=adnm%>";
		sessionStorage.removeItem('userName');
		sessionStorage.setItem('userName', adnm);
			
		var page_navi = tag_place("<%=page_navi%>");
		$('#page_navi').html(page_navi);

		$("#btn").click(function(){
			location.href="/admin/web/orgm_write";
		});
		
		$('#searchAction').click(function(){
			var frm = document.writehtm;
			$('#nowPage').val(1);
			frm.action = '/admin/web/orgm_list';
			frm.submit();
		});
		
		$("#search_text").keydown(function(e){
			if(e.keyCode == 13) $('#searchAction').click();
		});
		
		$('#openWriteForm').click(function(){
			var url = '/admin/web/orgm_write?mode=insert&s_org_no='+$('#orgSeqList').val()+'&param_major='+$("#param_major").val()+'&param_area='+$("#param_area").val();
			window.open(url ,'', 'width=850,height=820');
		});
		
		$("#btnExport").on('click', function () {
			var frm = document.writehtm;
		    var url = "admin_exceldown";
		    
		    frm.action = url;
		    frm.method = "post";
		    frm.submit();
		});
		
		// 체크박스 전체선택
	    $(document).on("click", "#ROW_CHK_ALL", function(e) {
	        if($(this).prop("checked")) {
	        	$("#index_total").val("<%=db_data_totallist %>");
	        	$("#index_cnt").val(<%=db_data.length %>);
	        	
	            $(".ROW_CHK").prop("checked", true);
	        }else{
	        	$("#index_total").val("");
	        	$("#index_cnt").val(0);
	        	
	            $(".ROW_CHK").prop("checked", false);
	        }
	        
	    });
	    
	    // ROW의 체크박스 선택 이벤트
	    $(document).on("click", ".ROW_CHK", function(e) {
	    	var checks = new Array();
	    	var tdArr = new Array();
	    	var count = 0;
	    	
	    	var checkbox = $("input[name=ROW_CHK]:checked");
	    	
	    	checkbox.each(function(i) {
	    		var tr = checkbox.parent().parent().eq(i);
	    		var td = tr.children();
	    		
	    		checks.push(tr.text());
	    		var row_index = $.trim(td.eq(1).text());
	    		
	    		tdArr.push(row_index);
	    		count++;
	    	});
	    	$("#index_total").val(tdArr);
	    	$("#index_cnt").val(count);
			
	        var CHK_TOT_CNT = $(".ROW_CHK").length;
	        var CHK_CNT = $('input:checkbox[name="ROW_CHK"]:checked').length;
	        
	        if(CHK_TOT_CNT == CHK_CNT) {
	            $("#ROW_CHK_ALL").prop("checked", true);
	        } else {
	            $("#ROW_CHK_ALL").prop("checked", false);
	        }
	    });
		
		// 체크박스 전체선택
		$(document).on("click", "#ROW_CHK_ALL", function(e) {
			if($(this).prop("checked")) {
				$(".ROW_CHK").prop("checked", true);
			}else{
				$(".ROW_CHK").prop("checked", false);
			}
		});
		
		/* // ROW의 체크박스 선택 이벤트
		$(document).on("click", ".ROW_CHK", function(e) {
			var CHK_TOT_CNT = $(".ROW_CHK").length;
			var CHK_CNT = $('input:checkbox[name="ROW_CHK"]:checked').length;
			
			if(CHK_TOT_CNT == CHK_CNT) {
				$("#ROW_CHK_ALL").prop("checked", true);
			} else {
				$("#ROW_CHK_ALL").prop("checked", false);
			}
		}); */
		
		// 회원 노출
		$(document).on("click", "#btnUserUnLocked", function(e) {
			fnUserLockUnLock('Y');
		});
		
		// 회원 비노출
		$(document).on("click", "#btnUserLocked", function(e) {
			fnUserLockUnLock('N');
		});
	});
	
	function fnUserLockUnLock(LOCK_VALUE) {
		var CHK_CNT = $('input:checkbox[name="ROW_CHK"]:checked').length;
				
		if(CHK_CNT == 0){
			alert('비노출할 회원을 한개 이상 선택 해주세요.');
			return;
		}
		
		var CHKED_ARRY = "";
		$('input:checkbox[name="ROW_CHK"]:checked').each(function(index, item) {
			var IDX = $(this).attr("IDX")
			if(index > 0) {
				CHKED_ARRY += ', ' + IDX;
			} else {
				CHKED_ARRY += IDX;
			}
		});
		
		var ALERT_MSG = "";
		if(LOCK_VALUE == "N") {
			ALERT_MSG = CHK_CNT + "명에 대해서 비노출 처리를 하시겠습니까?";
		} else if(LOCK_VALUE == "Y") {
			ALERT_MSG = CHK_CNT + "명에 대해서 노출 처리를 하시겠습니까?";
		}
		
		if(confirm(ALERT_MSG)) {
			$.ajax({
				type : "post",  
			    url : "/admin/web/orgm_udpateDisp",    
			    dataType : "json",
			    data : { "CHKED_ARRY" : CHKED_ARRY, "LOCK_VALUE" : LOCK_VALUE },
			    success : function(data){
			    	alert(data.result_msg);
			    	if(!data.result) console.log(data.result_log);
			    	
			    	$("#searchAction").click();
			    }, error : function(xhr, status, error) { // error 발생했을때
			    	alert('오류가 발생되었습니다. 시스템관리자에게 문의하시기 바랍니다.');
		      	}
			});
		}
	}
	
	function del(no){
		if(confirm("삭제하시겠습니까?")){
			var frm = document.writehtm;
			$("#brd_no").val(no);
			frm.action = '/admin/web/orgm_del';
			frm.submit();
		}
	}
	
	function restore(no, name, code, num){
		var confirmHTML = "";
		confirmHTML = "======= 사용자 정보 ======= \n";
		confirmHTML += "이름 : "+name+" \n";
		confirmHTML += "기수코드 : "+code+" \n";
		confirmHTML += "휴대폰 : "+num+" \n";
		confirmHTML += "======================= \n\n";
		confirmHTML += "위 사용자를 복원 하시겠습니까?";
		
		if(confirm(confirmHTML)){
			var frm = document.writehtm;
			$("#brd_no").val(no);
			frm.action = '/admin/web/orgm_restore';
			frm.submit();
		}
	}
	
	function goPage(p_num){
		var frm = document.writehtm;
		frm.action = '/admin/web/orgm_list';
		frm.nowPage.value = p_num;
		frm.submit();
		
	}
	
	function seqListPopup(){
		window.open('/admin/web/orgSeq_mngt', 'orgSeq_mngt','width=450,height=160');
	}
	
	function print_preview(){
		var CHK_CNT = $('input:checkbox[name="ROW_CHK"]:checked').length;
		
		if(CHK_CNT == 0){
			alert("선택된 기업이 없습니다.");
			return false;
		} else {
			var popup_form = document.writehtm;
			var url = '/admin/web/print_admin_list';
			window.open('', 'print_admin_list','width=780,height=900,scrollbars=yes');
			
			popup_form.action = url;
			popup_form.target = 'print_admin_list';
			popup_form.submit();
			location.reload();
		}
	}
	
</script>

	<form action="/admin/web/orgm_list" id="writehtm" name="writehtm" method="post" onsubmit="return false;" autocomplete="off">
		<input type="hidden" name="nowPage" value="<%=nowPage%>" id="nowPage"/>
		<input type="hidden" name="index_total" id="index_total" />
    	<input type="hidden" name="index_cnt" id="index_cnt" />
    	<input type="hidden" name="brd_no" id="brd_no" value=""/>
		<input type="hidden" name="status" id="status" />
		
		<div class="board_search">
			<h3 class="float_l">졸업생관리</h3>
			<p class="float_r">
				Total : <%=total_cnt%>
				<% if(order_type == 'no'){ %>
					<input type="radio" name="order_type" value="no" checked="checked">최근등록순
					<input type="radio" name="order_type" value="name">가나다순
				<% }else { %> 
					<input type="radio" name="order_type" value="no">최근등록순
					<input type="radio" name="order_type" value="name" checked="checked">가나다순
				<% } %>
				&nbsp;
		
				<select name="search_type">
					<option value="all"<%if(search_type=="all"){%> selected="selected" <%}%>> - 전체 - </option>
					<option value="orgmem_name"<%if(search_type=="orgmem_name"){%> selected="selected" <%}%>>이름</option>
					<option value="orgmem_seqNo"<%if(search_type=="orgmem_seqNo"){%> selected="selected" <%}%>>졸업기수</option>
				</select>
				
				<input type="text" name="search_text" id="search_text" value="<%=search_text%>" style="ime-mode:active; height: 24px;">
				
				<button class="ui-button" id="searchAction" type="button">
					<span class="ui-icon ui-icon-search"></span>검색
				</button>
			
			</p>
		</div>
	
		<div class="board_list" style="overflow-y:scroll;width: 1070px; height:728px; border-top: 2px solid #3b64af;">
			<table id="tblExport" border="0">
				<colgroup>
					<col width="3%" />
					<col width="6%" />
					<col width="6%" />
					<col width="6%" />
					<col width="6%" />
					<col width="13%" />
					<col width="13%" />
					<col width="20%" />
					<col width="13%" />

				</colgroup>
				
				<thead>
					<tr>
						<th><input type="checkbox" name="ROW_CHK_ALL" id="ROW_CHK_ALL" /></th>
						<th>번호</th>
						<th>졸업기수</th>
						<th>졸업반</th>
						<th>이름</th>
						<th>회사명</th>
						<th>연락처</th>
						<th>주소</th>
						<th>비고</th>
					
					</tr>
				</thead>
				
				<tbody>
				<% if(db_data.length > 0) {
					for(var i = 0; i < db_data.length; i++){ %>
						<tr>
							<td><input type="checkbox" name="ROW_CHK" class="ROW_CHK" IDX="<%=db_data[i].orgmem_no %>" /></td>
							<td style="display:none;">
								<%=db_data[i].orgmem_no%>
							</td>
							<td style="text-overflow: ellipsis; white-space: nowrap; overflow: hidden; text-align:center;" class="hand" onclick="MM_openBrWindow_view_company('/admin/web/company_view','class_write','width=550,height=780','<%=db_data[i].orgmem_no%>')">
								<%=page_start++%>
							</td>
							<td style="text-overflow: ellipsis; white-space: nowrap; overflow: hidden; text-align:center;" class="hand" onclick="MM_openBrWindow_view_company('/admin/web/company_view','class_write','width=550,height=780','<%=db_data[i].orgmem_no%>')">
								<%=db_data[i].orgmem_seqNo %>
							</td>
							<td style="text-overflow: ellipsis; white-space: nowrap; overflow: hidden; text-align:center;" class="hand" onclick="MM_openBrWindow_view_company('/admin/web/company_view','class_write','width=550,height=780','<%=db_data[i].orgmem_no%>')">
								<%=db_data[i].orgmem_class %>
							</td>
							<td style="text-overflow: ellipsis; white-space: nowrap; overflow: hidden; text-align:center;" class="hand" onclick="MM_openBrWindow_view_company('/admin/web/company_view','class_write','width=550,height=780','<%=db_data[i].orgmem_no%>')"> 
								<%=db_data[i].orgmem_name %>
							</td>
							<td style="text-overflow: ellipsis; white-space: nowrap; overflow: hidden; text-align: center;" class="hand" onclick="MM_openBrWindow_view_company('/admin/web/company_view','class_write','width=550,height=780','<%=db_data[i].orgmem_no%>')">
								<% if(db_data[i].company_name != '' && db_data[i].company_name != 'null' && db_data[i].company_name != null) { %>
									<%=db_data[i].company_name %>
								<% } else { %>
								<% } %>
							</td>
							<td style="text-overflow: ellipsis; white-space: nowrap; overflow: hidden; text-align: center;" class="hand" onclick="MM_openBrWindow_view_company('/admin/web/company_view','class_write','width=550,height=780','<%=db_data[i].orgmem_no%>')">
								<% if(db_data[i].orgmem_phone1 != '' && db_data[i].orgmem_phone1 != 'null' && db_data[i].orgmem_phone1 != null) { %>
									
									<%=db_data[i].orgmem_phone1 %>-<%=db_data[i].orgmem_phone2 %>-<%=db_data[i].orgmem_phone3 %>
								<% } else { %>
								<% } %>
							</td>
							<td style="text-overflow: ellipsis; white-space: nowrap; overflow: hidden; text-align: center;" class="hand" onclick="MM_openBrWindow_view_company('/admin/web/company_view','class_write','width=550,height=780','<%=db_data[i].orgmem_no%>')">
								<% if(db_data[i].orgmem_home_addr1 != '' && db_data[i].orgmem_home_addr1 != 'null' && db_data[i].orgmem_home_addr1 != null) { %>
									<%=db_data[i].orgmem_home_addr1 %>
								<% } else { %>
								<% } %>
							</td>
							<td>
								<a href="#" onclick="MM_openBrWindow_view_company('/admin/web/company_modify', '', 'scrollbars=yes, width=550,height=860', '<%=db_data[i].orgmem_no%>', 'modify')">
									<img src="/images/admin/icon_edit.gif" alt="수정" />
								</a>
								<a href="#" onclick="del(<%=db_data[i].orgmem_no %>)" id="del" name="del">
									<img src="/images/admin/icon_delete.gif" alt="삭제" />
								</a>
							</td>
							
						</tr>
					<% } } else {%>
					<tr>
						<td colspan="8">등록된 회원이 없습니다.</td>
					</tr>
				<% } %>
				</tbody>
			</table>
		</div>
		
	</form>
	<!-- 페이징 -->
	<div class="mt_20">
		<div class="paging" id="page_navi">
		</div>
		<p class="float_r">
		
			<button class="ui-button" id="btnExport" type="button">
				<span class="ui-icon ui-icon-print"></span>엑셀다운
			</button>
			<button class="ui-button" type="button" onclick="MM_openBrWindow_company('/admin/web/company_write','class_write','width=550,height=860','','insert')" >
				<span class="ui-icon ui-icon-document"></span>등록
			</button>
		</p>
	</div>
	<!-- //페이징 -->